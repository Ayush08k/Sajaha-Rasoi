<div class="profile-container">
  <!-- Header -->
  <header class="profile-header">
    <button class="btn-back" (click)="onBack()">
      <img src="assets/Icon/back-arrow.png" alt="back-arrow">
    </button>
    <h1 class="text-header">My Profile</h1>
  
  </header>

  <!-- Profile Card -->
  <div class="card profile-card">
    <div class="profile-info">
      <div class="avatar-lg">
        <img src="assets/Icon/user.png" alt="user photo" class="avatar-image">
      </div>
      <div class="user-details">
        @if (!isEditingName()) {
          <div class="name-display">
            <h2 class="text-subheader-lg text-primary">{{ userProfile().name }}</h2>
            <button class="edit-name-btn" (click)="startEditingName()">
              <span class="material-symbols-outlined">edit</span>
            </button>
          </div>
        } @else {
          <div class="name-edit">
            <div class="form-group">
              <input
                type="text"
                class="name-input"
                [class.error]="nameError()"
                [(ngModel)]="editedName"
                placeholder="Enter your name"
                [disabled]="isUpdatingName()"
                maxlength="50"
              />
              @if (nameError()) {
                <div class="error-message">{{ nameError() }}</div>
              }
            </div>
            <div class="edit-actions">
              <button
                class="btn-save"
                (click)="saveNameEdit()"
                [disabled]="editedName().trim().length < 2 || isUpdatingName()"
              >
                @if (isUpdatingName()) {
                  <div class="loading-spinner"></div>
                } @else {
                  <span class="material-symbols-outlined">check</span>
                }
              </button>
              <button
                class="btn-cancel"
                (click)="cancelEditingName()"
                [disabled]="isUpdatingName()"
              >
                <span class="material-symbols-outlined">close</span>
              </button>
            </div>
          </div>
        }
        <p class="text-body text-secondary">{{ userProfile().phone }}</p>
        <p class="text-small text-secondary">üìç {{ userProfile().location }}</p>
        <p class="text-small text-secondary">Member since {{ userProfile().joinDate }}</p>
      </div>
    </div>
    
    <!-- Stats Row -->
    <div class="stats-row">
      <div class="stat-item">
        <div class="stat-value">{{ userProfile().rating }}</div>
        <div class="stat-label">Rating</div>
        
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <div class="stat-value">{{ userProfile().totalListed }}</div>
        <div class="stat-label">Total Listed</div>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <div class="stat-value">{{ userProfile().activeListing }}</div>
        <div class="stat-label">Active</div>
      </div>
    </div>
  </div>

  <!-- Listings Section -->
  <div class="card listings-section">
    <div class="section-header">
      <h3 class="text-subheader">My Listings</h3>
      <button class="btn btn-accent" (click)="onCreateNewListing()">
        Add New Listing
      </button>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
      <button 
        class="filter-tab"
        [class.active]="activeFilter() === 'all'"
        (click)="setFilter('all')"
      >
        All ({{ getFilterCount('all') }})
      </button>
      <button 
        class="filter-tab"
        [class.active]="activeFilter() === 'active'"
        (click)="setFilter('active')"
      >
        Active ({{ getFilterCount('active') }})
      </button>
      <button 
        class="filter-tab"
        [class.active]="activeFilter() === 'sold'"
        (click)="setFilter('sold')"
      >
        Sold ({{ getFilterCount('sold') }})
      </button>
    </div>

    <!-- Listing Items -->
    <div class="listings-list">
      <div class="listing-item" *ngFor="let listing of getFilteredListings()">
        <div class="listing-image">
          <span class="material-symbols-outlined">image</span>
        </div>
        <div class="listing-content">
          <div class="listing-header">
            <h4 class="text-subheader text-primary">{{ listing.name }}</h4>
            <span class="badge" [class]="getStatusBadgeClass(listing.status)">
              {{ getStatusText(listing.status) }}
            </span>
          </div>
          <div class="listing-price-qty">
            <span class="price">‚Çπ{{ listing.price }}</span>
            <span class="quantity">{{ listing.quantity }}</span>
          </div>
          <p class="listing-description text-small text-secondary">{{ listing.description }}</p>
          <div class="listing-meta">
            <span class="meta-item">{{ listing.createdDate }}</span>
            <span class="meta-item">{{ listing.views }} views</span>
            <span class="meta-item">{{ listing.interestedCount }} interested</span>
          </div>
        </div>
        <div class="listing-actions">
          <button
            class="action-btn"
            (click)="onEditListing(listing.id!)"
            [disabled]="isDeletingListing() === listing.id"
          >
            <span class="material-symbols-outlined">edit</span>
          </button>
          <button
            class="action-btn delete"
            (click)="onDeleteListing(listing.id!)"
            [disabled]="isDeletingListing() === listing.id"
          >
            <ng-container *ngIf="isDeletingListing() === listing.id; else deleteIcon">
              <div class="loading-spinner-small"></div>
            </ng-container>
            <ng-template #deleteIcon>
              <span class="material-symbols-outlined">delete</span>
            </ng-template>
          </button>
        </div>
      </div>
      
      <ng-container *ngIf="getFilteredListings().length === 0">
        <div class="empty-state">
          <span class="material-symbols-outlined">
            <img src="assets/Icon/empty.png" alt="empty">
          </span>
          <p class="text-body text-secondary">No listings found</p>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Settings Card -->
  <div class="card settings-section">
    <h3 class="text-subheader mb-4">Settings</h3>
    <div class="settings-menu">
      <button class="setting-item">
        <span class="material-symbols-outlined">
        <img src="assets/Icon/notification.png" alt="notification">
        </span>
        <span class="setting-text">Notification Settings</span>
      </button>
      <button class="setting-item">
        <span class="material-symbols-outlined">
          <img src="assets/Icon/location.png" alt="location-icon">
        </span>
        <span class="setting-text">Location Settings</span>
      </button>
      <button class="setting-item">
        <span class="material-symbols-outlined">
          <img src="assets/Icon/help.png" alt="help-icon">
        </span>
        <span class="setting-text">Help & Support</span>
      </button>
      <button class="setting-item logout" (click)="onLogout()">
        <span class="material-symbols-outlined">
        </span>
        <span class="setting-text">Logout</span>
      </button>
    </div>
  </div>
</div>
