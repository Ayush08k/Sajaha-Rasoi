<div class="flex h-screen flex-col">
  <div class="sticky p-4 top-0 z-10 flex items-center gap-3 border-b border-gray-200 bg-white p-3 chat-header ">
    <button (click)="onBack()" class="flex h-10 w-10 items-center justify-center rounded-full text-gray-500 transition-colors hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-700">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
    </button>
    <div class="flex items-center gap-3">
      <div class="relative">
        <img class="h-10 w-10 rounded-full" src="assets/Icon/user.png" alt="user-avatar" />
        <span class="absolute bottom-0 right-0 block h-2.5 w-2.5 rounded-full bg-green-500 ring-2 ring-white dark:ring-gray-800"></span>
      </div>
      <div>
        <h2 class="font-semibold text-gray-800 dark:text-gray-100">{{ otherUserName() }}</h2>
        <span class="text-xs text-green-500">Active now</span>
      </div>
    </div>
  </div>

  <div #messagesContainer class="flex-1 overflow-y-auto scroll-smooth p-4">
    <div class="flex flex-col gap-3">
      @for (message of messages(); track message.id; let i = $index) {
        @if (isNewDay(message, i > 0 ? messages()[i-1] : null)) {
          <div class="my-4 flex justify-center">
            <span class="flex h-11 px-3 py-1 text-xs font-semibold text-slate-400">
              {{ formatDate(message.timestamp) }}
            </span>
          </div>
        }
        
        <div class="flex" [ngClass]="{'justify-end': message.isOwn, 'justify-start': !message.isOwn}">
          <div class="flex max-w-[75%] flex-col" [ngClass]="{'items-end': message.isOwn, 'items-start': !message.isOwn}">
            <div class="py-2 px-3 shadow-sm" [ngClass]="{
              'max-w-xs bg-blue-700 text-white p-4 rounded-2xl rounded-tr-none shadow-md': message.isOwn,
              '': !message.isOwn
            }">
              <p class="text-sm">{{ message.text }}</p>
            </div>
            <span class="mt-1 text-xs text-gray-400 dark:text-gray-500">
              {{ formatTime(message.timestamp) }}
            </span>
          </div>
        </div>
      }
    </div>
  </div>

  <div class="sticky bottom-0 border-t border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800">
    <div class="flex items-center gap-2">
      <input
        #messageInput
        type="text"
        class="flex-1 p-2 rounded-full border-transparent bg-gray-100 py-2 px-4 text-gray-800 placeholder-gray-500 focus:border-transparent focus:ring-0 dark:bg-gray-700 dark:text-gray-200"
        placeholder="Type a message..."
        [value]="newMessage()"
        (input)="onMessageInputChange($event)"
        (keypress)="onKeyPress($event)"
        maxlength="500"
      />
      <button
        class="flex h-11 w-11 flex-shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-sky-500 to-cyan-400 text-white shadow-lg transition-transform duration-200 hover:scale-110 active:scale-95 disabled:scale-100 disabled:cursor-not-allowed disabled:from-slate-600 disabled:to-slate-600"
        [disabled]="newMessage().trim() === ''"
        (click)="onSendMessage()">
        <img src="assets/Icon/send.png" alt="">
      </button>
    </div>
  </div>
</div>